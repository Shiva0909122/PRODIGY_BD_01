<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>About        Basic REST API with CRUD Operations</h1>
    <script>
import express from 'express';
import { v4 as uuidv4 } from 'uuid';
import fetch from 'node-fetch';  // Use import here

const app = express();
const PORT = 8000;

// Middleware
app.use(express.json());

// In-memory data store
const users = new Map();

// Helper function to validate email
function isValidEmail(email) {
    const emailRegex = /^[\w-\.]+@[\w-\.]+\.[a-z]{2,7}$/i;
    return emailRegex.test(email);
}

// Create user
app.post('/users', (req, res) => {
    const { name, email, age } = req.body;

    if (!name || !email || !age) {
        return res.status(400).json({ error: 'Name, email, and age are required.' });
    }

    if (!isValidEmail(email)) {
        return res.status(400).json({ error: 'Invalid email format.' });
    }

    const id = uuidv4();
    const newUser = { id, name, email, age };
    users.set(id, newUser);

    res.status(201).json(newUser);
});

// Read all users
app.get('/users', (req, res) => {
    res.json(Array.from(users.values()));
});

// Read user by ID
app.get('/users/:id', (req, res) => {
    const { id } = req.params;
    const user = users.get(id);

    if (!user) {
        return res.status(404).json({ error: 'User not found.' });
    }

    res.json(user);
});

// Update user
app.put('/users/:id', (req, res) => {
    const { id } = req.params;
    const { name, email, age } = req.body;

    const user = users.get(id);

    if (!user) {
        return res.status(404).json({ error: 'User not found.' });
    }

    if (email && !isValidEmail(email)) {
        return res.status(400).json({ error: 'Invalid email format.' });
    }

    const updatedUser = {
        ...user,
        name: name || user.name,
        email: email || user.email,
        age: age || user.age
    };

    users.set(id, updatedUser);

    res.json(updatedUser);
});

// Delete user
app.delete('/users/:id', (req, res) => {
    const { id } = req.params;

    if (!users.has(id)) {
        return res.status(404).json({ error: 'User not found.' });
    }

    users.delete(id);

    res.status(204).send();
});

// Fetch the users (now works with ES modules)
// fetch('http://localhost:8000/users', {
//     method: 'POST',
//     headers: {
//         'Content-Type': 'application/json'
//     },
//     body: JSON.stringify({
//         name: 'shivarth',
//         email: 'shivarth.drona@gmail.com',
//         age: 30
//     })
// })
// .then(response => response.json())
// .then(data => console.log('User created:', data))
// .catch(error => console.error('Error:', error));


const usersToCreate = [
    { name: 'Shivarth', email: 'shivarth.drona@gmail.com', age: 30 },
    { name: 'Alice', email: 'alice@example.com', age: 28 },
    { name: 'Bob', email: 'bob@example.com', age: 35 },
    {name:'prodigy', email:"prody@gmail.com" , age:67},
];

const userIdsToDelete = [
    'user-id-1', // replace with actual user IDs
    'user-id-2', // replace with actual user IDs
    'user-id-3', // replace with actual user IDs
];

// Create multiple users
usersToCreate.forEach(user => {
    fetch('http://localhost:8000/users', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(user)
    })
    .then(response => response.json())
    .then(data => console.log('User created:', data))
    .catch(error => console.error('Error:', error));
});

// Delete multiple users
userIdsToDelete.forEach(id => {
    fetch(`http://localhost:8000/users/${id}`, {
        method: 'DELETE',
    })
    .then(response => {
        if (response.ok) {
            console.log(`User with ID ${id} deleted.`);
        } else {
            console.error(`Failed to delete user with ID ${id}`);
        }
    })
    .catch(error => console.error('Error:', error));
});

// Start the server
app.listen(PORT, () => {
    console.log(`Server running on http://localhost:${PORT}`);
});

    </script>
    Here is a `README.md` file for your **User Management API** in Node.js and Express.

```markdown
# User Management API

A simple REST API built with Node.js and Express to perform CRUD (Create, Read, Update, Delete) operations on user data. The API allows users to be created, retrieved, updated, and deleted, with all data stored in memory.

## API Endpoints

### 1. Create User (POST /users)
Create a new user by providing `name`, `email`, and `age`.

#### Request Body:
```json
{
    "name": "John Doe",
    "email": "john.doe@example.com",
    "age": 30
}
```

#### Response:
- **201 Created** - Returns the created user object.
- **400 Bad Request** - If required fields are missing or email is invalid.

### 2. Get User by ID (GET /users/:id)
Fetch a user by their unique `id`.

#### Example Request:
```bash
GET /users/123e4567-e89b-12d3-a456-426614174000
```

#### Response:
- **200 OK** - Returns the user object.
- **404 Not Found** - If the user does not exist.

### 3. Update User (PUT /users/:id)
Update a user by `id`. You can update any of the following fields: `name`, `email`, or `age`.

#### Example Request:
```json
{
    "name": "Jane Doe",
    "age": 25
}
```

#### Response:
- **200 OK** - Returns the updated user object.
- **404 Not Found** - If the user does not exist.
- **400 Bad Request** - If the email format is invalid.

### 4. Delete User (DELETE /users/:id)
Delete a user by their unique `id`.

#### Example Request:
```bash
DELETE /users/123e4567-e89b-12d3-a456-426614174000
```

#### Response:
- **200 OK** - Returns a success message.
- **404 Not Found** - If the user does not exist.

### 5. List All Users (GET /users)
Fetch all users stored in the API.

#### Example Request:
```bash
GET /users
```

#### Response:
- **200 OK** - Returns a list of all users.

## Input Validation
- **Email validation**: The API ensures that the email provided follows a proper format using a regular expression.
- **Missing fields**: If any required fields (`name`, `email`, or `age`) are missing in the request body, the API will return a **400 Bad Request** response.

## Running the API

### Prerequisites
Ensure you have **Node.js** installed. If not, you can download it from [nodejs.org](https://nodejs.org/).

### 1. Install Dependencies

Install the required dependencies by running:

```bash
npm install express body-parser uuid
```

### 2. Run the Server

Start the server by running the following command:

```bash
node app.js
```

The server will start and the API will be available at `http://localhost:3000`.

### Example API Usage

1. **Create a User** (POST /users):

   ```bash
   curl -X POST http://localhost:3000/users -H "Content-Type: application/json" -d '{"name": "John Doe", "email": "john.doe@example.com", "age": 30}'
   ```

2. **Get a User by ID** (GET /users/<user_id>):

   ```bash
   curl http://localhost:3000/users/<user_id>
   ```

3. **Update a User** (PUT /users/<user_id>):

   ```bash
   curl -X PUT http://localhost:3000/users/<user_id> -H "Content-Type: application/json" -d '{"age": 31}'
   ```

4. **Delete a User** (DELETE /users/<user_id>):

   ```bash
   curl -X DELETE http://localhost:3000/users/<user_id>
   ```

5. **List All Users** (GET /users):

   ```bash
   curl http://localhost:3000/users
   ```

## Folder Structure

```
- app.js           # Main API logic (server and routes)
- package.json     # Project dependencies and scripts
- README.md        # API documentation
```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
```

### How to Use the `README.md`:
1. **Install Dependencies**: Use `npm install` to install the necessary packages (Express, Body-Parser, UUID).
2. **Run the Server**: Start the API using `node app.js`.
3. **Make Requests**: You can test the endpoints using `curl` commands as provided in the examples.

This `README.md` file includes detailed instructions on how to set up, run, and interact with your User Management API.
</body>

</html>
